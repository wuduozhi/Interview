# Message Queue

## Why use it ？

1. 异步处理  -> 加快相应速度，提高吞吐量
2. 流量控制  -> 削峰填谷。保护下游服务，下游服务根据自身能力处理请求；易于下游服务水平扩容。**令牌流量控制**
3. 解藕     -> 实现上下游的解藕
4. 连接流计算任务和数据
5. 用于将消息广播给大量接受者

简单说，在单体应用中，需要用队列解决的问题，在分布式系统中，都能用消息队列来解决。

当然，不同的选择都是 trade-off，消息队列也有其局限性：

* 引入消息队列带来的延迟问题
* 增加系统负责度
* 有数据不一致问题

## 一些常见的 Message Queue

1. RabbitMQ

功能、性能稍差，开箱即用。

2. RocketMQ

性能 ok,低延迟，适合在线业务

3. Kafka

性能很 ok，高延迟，适合离线业务，与周边生态系统兼容性好

## 基础概念

1. 队列

2. 主题

3. 分区

![模型](https://static001.geekbang.org/resource/image/46/17/465142ab5b5096f283118c307e8cc117.jpg)


## 如何保证不丢消息

* 如何检测消息丢失？


* 如何确保消息可靠传递？

![消息收发过程](https://static001.geekbang.org/resource/image/81/05/81a01f5218614efea2838b0808709205.jpg)


